{"ast":null,"code":"import{createContext,useContext,useEffect,useState,useCallback}from\"react\";import api,{setUnauthorizedHandler}from\"../services/api\";import{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext(null);const STORAGE_KEY=\"@chamados-ti:auth\";const TOKEN_KEY=\"token\";export function AuthProvider(_ref){let{children}=_ref;const[usuario,setUsuario]=useState(null);const[carregando,setCarregando]=useState(true);const[erro,setErro]=useState(null);/**\n   * Recupera sessÃ£o salva\n   */useEffect(()=>{const dadosSalvos=sessionStorage.getItem(STORAGE_KEY);if(dadosSalvos){try{const{usuario}=JSON.parse(dadosSalvos);setUsuario(usuario);}catch(_unused){sessionStorage.removeItem(STORAGE_KEY);}}setCarregando(false);},[]);/**\n   * Persiste sessÃ£o\n   */useEffect(()=>{if(usuario){sessionStorage.setItem(STORAGE_KEY,JSON.stringify({usuario}));}else{sessionStorage.removeItem(STORAGE_KEY);}},[usuario]);/**\n   * LOGIN REAL (BACKEND)\n   */async function login(email,senha){setCarregando(true);setErro(null);try{const response=await api.post(\"/auth/login\",{email,senha});const{token,usuario}=response.data.data;// ðŸ”‘ salva o token para as prÃ³ximas requisiÃ§Ãµes\nsessionStorage.setItem(TOKEN_KEY,token);setUsuario(usuario);return true;}catch(error){setErro(error.message||\"Email ou senha invÃ¡lidos\");return false;}finally{setCarregando(false);}}/**\n   * LOGOUT\n   */const logout=useCallback(()=>{sessionStorage.removeItem(TOKEN_KEY);setUsuario(null);},[]);useEffect(()=>{setUnauthorizedHandler(()=>logout());},[logout]);const estaAutenticado=Boolean(usuario);return/*#__PURE__*/_jsx(AuthContext.Provider,{value:{usuario,estaAutenticado,carregando,erro,login,logout},children:children});}export function useAuth(){const ctx=useContext(AuthContext);if(!ctx){throw new Error(\"useAuth deve ser usado dentro de AuthProvider\");}return ctx;}","map":{"version":3,"names":["createContext","useContext","useEffect","useState","useCallback","api","setUnauthorizedHandler","jsx","_jsx","AuthContext","STORAGE_KEY","TOKEN_KEY","AuthProvider","_ref","children","usuario","setUsuario","carregando","setCarregando","erro","setErro","dadosSalvos","sessionStorage","getItem","JSON","parse","_unused","removeItem","setItem","stringify","login","email","senha","response","post","token","data","error","message","logout","estaAutenticado","Boolean","Provider","value","useAuth","ctx","Error"],"sources":["/home/diniz_jessica/development/chamados-ti/frontend/src/contextos/authContext.js"],"sourcesContent":["import { createContext, useContext, useEffect, useState, useCallback } from \"react\";\nimport api, { setUnauthorizedHandler } from \"../services/api\";\n\nconst AuthContext = createContext(null);\n\nconst STORAGE_KEY = \"@chamados-ti:auth\";\nconst TOKEN_KEY = \"token\";\n\nexport function AuthProvider({ children }) {\n  const [usuario, setUsuario] = useState(null);\n  const [carregando, setCarregando] = useState(true);\n  const [erro, setErro] = useState(null);\n\n  /**\n   * Recupera sessÃ£o salva\n   */\n  useEffect(() => {\n    const dadosSalvos = sessionStorage.getItem(STORAGE_KEY);\n\n    if (dadosSalvos) {\n      try {\n        const { usuario } = JSON.parse(dadosSalvos);\n        setUsuario(usuario);\n      } catch {\n        sessionStorage.removeItem(STORAGE_KEY);\n      }\n    }\n\n    setCarregando(false);\n  }, []);\n\n  /**\n   * Persiste sessÃ£o\n   */\n  useEffect(() => {\n    if (usuario) {\n      sessionStorage.setItem(\n        STORAGE_KEY,\n        JSON.stringify({ usuario })\n      );\n    } else {\n      sessionStorage.removeItem(STORAGE_KEY);\n    }\n  }, [usuario]);\n\n  /**\n   * LOGIN REAL (BACKEND)\n   */\n  async function login(email, senha) {\n    setCarregando(true);\n    setErro(null);\n\n    try {\n      const response = await api.post(\"/auth/login\", {\n        email,\n        senha,\n      });\n\n      const { token, usuario } = response.data.data;\n\n      // ðŸ”‘ salva o token para as prÃ³ximas requisiÃ§Ãµes\n      sessionStorage.setItem(TOKEN_KEY, token);\n\n      setUsuario(usuario);\n      return true;\n    } catch (error) {\n      setErro(error.message || \"Email ou senha invÃ¡lidos\");\n      return false;\n    } finally {\n      setCarregando(false);\n    }\n  }\n\n  /**\n   * LOGOUT\n   */\n  const logout = useCallback(() => {\n    sessionStorage.removeItem(TOKEN_KEY);\n    setUsuario(null);\n  }, []);\n\n  useEffect(() => {\n    setUnauthorizedHandler(() => logout());\n  }, [logout]);\n\n  const estaAutenticado = Boolean(usuario);\n\n  return (\n    <AuthContext.Provider\n      value={{\n        usuario,\n        estaAutenticado,\n        carregando,\n        erro,\n        login,\n        logout,\n      }}\n    >\n      {children}\n    </AuthContext.Provider>\n  );\n}\n\nexport function useAuth() {\n  const ctx = useContext(AuthContext);\n  if (!ctx) {\n    throw new Error(\"useAuth deve ser usado dentro de AuthProvider\");\n  }\n  return ctx;\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}